generator client {
  provider   = "prisma-client-js"
  engineType = "library"
}



datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


// =======================
// ENUMS
// =======================

enum OrderStatus {
  PENDING
  PAID
  SHIPPED
  DELIVERED
  CANCELLED
}

enum PaymentStatus {
  INITIATED
  SUCCESS
  FAILED
}

// =======================
// USER
// =======================

model User {
  id        String   @id @default(cuid())
  kindeId   String   @unique
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())

  orders Order[]
}

// =======================
// CATEGORY
// =======================

model Category {
  id        String   @id @default(cuid())
  name      String   @unique
  slug      String   @unique
  description String?
  createdAt DateTime @default(now())

  products Product[]
}

// =======================
// PRODUCT
// =======================

model Product {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String
  basePrice   Int // price in paise
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())

  categoryId String
  category   Category @relation(fields: [categoryId], references: [id])

  variants ProductVariant[]
  images   Image[]
}

// =======================
// PRODUCT VARIANT
// =======================

model ProductVariant {
  id    String  @id @default(cuid())
  sku   String  @unique
  size  String? // S, M, L, XL (nullable for souvenirs)
  color String?
  stock Int
  price Int // override price (paise)

  productId String
  product   Product @relation(fields: [productId], references: [id])

  orderItems OrderItem[]
}

// =======================
// IMAGE
// =======================

model Image {
  id      String  @id @default(cuid())
  url     String
  altText String?

  productId String
  product   Product @relation(fields: [productId], references: [id])
}

// =======================
// ORDER
// =======================

model Order {
  id          String      @id @default(cuid())
  status      OrderStatus @default(PENDING)
  totalAmount Int // paise
  createdAt   DateTime    @default(now())

  userId String
  user   User   @relation(fields: [userId], references: [id])

  items   OrderItem[]
  payment Payment?
}

// =======================
// ORDER ITEM
// =======================

model OrderItem {
  id              String @id @default(cuid())
  quantity        Int
  priceAtPurchase Int // paise snapshot

  orderId String
  order   Order  @relation(fields: [orderId], references: [id])

  variantId String
  variant   ProductVariant @relation(fields: [variantId], references: [id])
}

// =======================
// PAYMENT
// =======================

model Payment {
  id             String        @id @default(cuid())
  stripeIntentId String        @unique
  status         PaymentStatus
  amount         Int // paise
  createdAt      DateTime      @default(now())

  orderId String @unique
  order   Order  @relation(fields: [orderId], references: [id])
}
